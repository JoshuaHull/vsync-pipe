{"version":3,"file":"vsync-pipe.mjs","sources":["../../../projects/vsync-pipe/src/lib/vsync.pipe.ts","../../../projects/vsync-pipe/src/lib/vsync-pipe.module.ts","../../../projects/vsync-pipe/src/vsync-pipe.ts"],"sourcesContent":["import { AsyncPipe } from \"@angular/common\";\r\nimport { ChangeDetectorRef, OnDestroy, Pipe, PipeTransform } from \"@angular/core\";\r\nimport {\r\n  ComputedRef,\r\n  Ref,\r\n  watchEffect,\r\n  WatchStopHandle,\r\n  WritableComputedRef,\r\n} from \"@vue/runtime-core\";\r\nimport { BehaviorSubject } from \"rxjs\";\r\n\r\n@Pipe({\r\n  name: \"vsync\",\r\n  pure: false,\r\n})\r\nexport class VsyncPipe implements OnDestroy, PipeTransform {\r\n  private out = new BehaviorSubject<any>(undefined);\r\n  private asyncPipe: AsyncPipe;\r\n  private stop: WatchStopHandle | undefined;\r\n\r\n  constructor(private _: ChangeDetectorRef) {\r\n    this.asyncPipe = new AsyncPipe(_);\r\n  }\r\n\r\n  transform(ref: Ref<any> | ComputedRef<any> | WritableComputedRef<any>) {\r\n    if (!this.stop && ref) {\r\n      this.stop = watchEffect(() => {\r\n        this.out.next(ref.value);\r\n      });\r\n    }\r\n\r\n    return this.asyncPipe.transform(this.out);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.out.complete();\r\n    this.stop?.();\r\n    this.asyncPipe.ngOnDestroy();\r\n  }\r\n}\r\n","import { NgModule } from \"@angular/core\";\nimport { VsyncPipe } from \"./vsync.pipe\";\n\n@NgModule({\n  declarations: [\n    VsyncPipe,\n  ],\n  exports: [\n    VsyncPipe,\n  ]\n})\nexport class VsyncPipeModule { }\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":";;;;;;MAea,SAAS,CAAA;AAKpB,IAAA,WAAA,CAAoB,CAAoB,EAAA;AAApB,QAAA,IAAC,CAAA,CAAA,GAAD,CAAC,CAAmB;QAJhC,IAAA,CAAA,GAAG,GAAG,IAAI,eAAe,CAAM,SAAS,CAAC,CAAC;QAKhD,IAAI,CAAC,SAAS,GAAG,IAAI,SAAS,CAAC,CAAC,CAAC,CAAC;KACnC;AAED,IAAA,SAAS,CAAC,GAA2D,EAAA;AACnE,QAAA,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,GAAG,EAAE;AACrB,YAAA,IAAI,CAAC,IAAI,GAAG,WAAW,CAAC,MAAK;gBAC3B,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AAC3B,aAAC,CAAC,CAAC;AACJ,SAAA;QAED,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KAC3C;IAED,WAAW,GAAA;;AACT,QAAA,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;AACpB,QAAA,CAAA,EAAA,GAAA,IAAI,CAAC,IAAI,MAAA,IAAA,IAAA,EAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,CAAA,IAAA,CAAI,CAAC;AACd,QAAA,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC;KAC9B;;sGAvBU,SAAS,EAAA,IAAA,EAAA,CAAA,EAAA,KAAA,EAAA,EAAA,CAAA,iBAAA,EAAA,CAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,IAAA,EAAA,CAAA,CAAA;oGAAT,SAAS,EAAA,IAAA,EAAA,OAAA,EAAA,IAAA,EAAA,KAAA,EAAA,CAAA,CAAA;2FAAT,SAAS,EAAA,UAAA,EAAA,CAAA;kBAJrB,IAAI;AAAC,YAAA,IAAA,EAAA,CAAA;AACJ,oBAAA,IAAI,EAAE,OAAO;AACb,oBAAA,IAAI,EAAE,KAAK;iBACZ,CAAA;;;MCHY,eAAe,CAAA;;4GAAf,eAAe,EAAA,IAAA,EAAA,EAAA,EAAA,MAAA,EAAA,EAAA,CAAA,eAAA,CAAA,QAAA,EAAA,CAAA,CAAA;6GAAf,eAAe,EAAA,YAAA,EAAA,CANxB,SAAS,CAAA,EAAA,OAAA,EAAA,CAGT,SAAS,CAAA,EAAA,CAAA,CAAA;6GAGA,eAAe,EAAA,CAAA,CAAA;2FAAf,eAAe,EAAA,UAAA,EAAA,CAAA;kBAR3B,QAAQ;AAAC,YAAA,IAAA,EAAA,CAAA;AACR,oBAAA,YAAY,EAAE;wBACZ,SAAS;AACV,qBAAA;AACD,oBAAA,OAAO,EAAE;wBACP,SAAS;AACV,qBAAA;iBACF,CAAA;;;ACVD;;AAEG;;;;"}